<!DOCTYPE html>
<html>
<body>
<head>
	<title>THREEJS DemoLib 1</title>
</head>

<script src="https://cdn.rawgit.com/chrismcg61/TechDemos/r240/MyLibs/ThreeMin/My3D.js"></script>
<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.rawgit.com/mrdoob/three.js/r157/build/three.module.js",
      "three/addons/": "https://cdn.rawgit.com/mrdoob/three.js/r157/examples/jsm/"
    }
  }
</script>



  
  
<script type="module">
import * as __THREE from 'three';
import Stats from 'three/addons/libs/stats.module.js';
import { GUI } from 'three/addons/libs/lil-gui.module.min.js';


var stats = new Stats();  document.body.appendChild( stats.dom );
var params = {  
  folder3:"SCENE",  meshNb:300,meshDetail:8,castShadow:true, ReInit:ReInit, backCol:0x002244,dirLightCol:0x111111,camLightCol:0x884400, pLightCamPosZ:-0.7,
  folder7:"CAM",  camPosX:0,camPosY:0.3,camPosZ:2.2,
}

var gui = new GUI();  MY3D.initGui(params, gui, {M0:0,M1:1});  //gui.folders[0].close()

MY3D.HH=800;  MY3D.WW=MY3D.HH*1.3;

MY3D.initWebglRenderer(__THREE)
MY3D.initSceneBackground()


initMyScene()
function ReInit() {
  MY3D.initSceneBackground()
  initMyScene()
}
function updateBackgroundConfig() {
  camera.position.set( params.camPosX, params.camPosY, params.camPosZ )  
  scene.background = new THREE.Color( params.backCol )
  directionalLight.color = new THREE.Color( params.dirLightCol )
  camPLight.position.z=params.pLightCamPosZ; camPLight.color=new THREE.Color(params.camLightCol); camPLight.castShadow=params.castShadow;
}
function initMyScene() {
  const NB_QUAD = params.meshNb
  var newInstancedMesh = new THREE.InstancedMesh( new THREE.TorusGeometry( 0.05,0.01, 6,params.meshDetail ),  new THREE.MeshStandardMaterial(),  NB_QUAD );
  for ( var ii=0; ii<NB_QUAD; ii++ ) {
    var dummy = new THREE.Mesh( );    // dummy.scale.set(1,1,1)
    dummy.position.set( Math.random(),Math.random(),Math.random() );  dummy.updateMatrix();
    newInstancedMesh.setMatrixAt( ii, dummy.matrix );  //.setColorAt ( ii, myCol )
  }
  newInstancedMesh.receiveShadow = newInstancedMesh.castShadow = params.castShadow;
  scene.add( newInstancedMesh );
}


animate();
function animate() {
  camPLight.rotation.y += 0.01  
  updateBackgroundConfig()
  //
  stats.update()  
  renderer.render( scene, camera );
  requestAnimationFrame( animate );
}
</script>


  
</body>
</html>
