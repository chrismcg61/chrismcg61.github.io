<!DOCTYPE html>
<html>
<head>
	<title>THREEJS DEMO2</title>
</head>

<body>
</body>

<script src="https://cdn.rawgit.com/chrismcg61/TechDemos/r228/MyLibs/ThreeMin/My3D.js"></script>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.rawgit.com/mrdoob/three.js/r156/build/three.module.js",
    "three/addons/": "https://cdn.rawgit.com/mrdoob/three.js/r156/examples/jsm/"
  }
}
</script>






	
	
	
<script type="module">

import * as __THREE from 'three';
import Stats from 'three/addons/libs/stats.module.js';
import { GUI } from 'three/addons/libs/lil-gui.module.min.js';


var stats = new Stats();  document.body.appendChild( stats.dom );
var params = {  groundRes:16,meshNb:90,basicMaterial:false,castShadow:true,ReInit:ReInit,  dirLightCol:0x444444,camLightCol:0x000000,camPosZ:3,  speedFactor:0.01,  }

MY3D.initGui(params, new GUI())

MY3D.HH=720;   MY3D.WW=MY3D.HH*1.6;

MY3D.initWebglRenderer(__THREE)
MY3D.initSceneBackground()


var rotGroup;
initMyScene()
function ReInit() {
  // MY3D.initWebglRenderer(THREE)
  MY3D.initSceneBackground()
  initMyScene()
}
function initMyScene() {
  directionalLight.castShadow = params.castShadow;
  //
  ground.position.y = -0.3  
  ground.geometry = new THREE.PlaneGeometry(6,6, params.groundRes,params.groundRes)
  ground.material = new THREE.MeshPhysicalMaterial({displacementMap:waterBumpMap,displacementScale:0.3})
  
  rotGroup = new THREE.Group();
  scene.add( rotGroup )   

  var myMeshMaterial = new THREE.MeshPhysicalMaterial({roughness:0.3,metalness:0.7,map:concreteMap,bumpMap:waterBumpMap,bumpScale:0.01})
  if(params.basicMaterial)  myMeshMaterial = new THREE.MeshBasicMaterial()
  var myMesh = new THREE.Mesh(new THREE.BoxGeometry(),  myMeshMaterial);
  myMesh.position.set( 0,0.6,0 )
  myMesh.castShadow = myMesh.receiveShadow = params.castShadow;
  rotGroup.add( myMesh );
  for ( var ii=0; ii<params.meshNb; ii++ ) {
    var newMesh = new THREE.Mesh(new THREE.BoxGeometry( 0.1,0.1,0.1 ),  myMeshMaterial);
    newMesh.position.set( sRand(3),rand(2),sRand(3) )
    newMesh.castShadow = newMesh.receiveShadow = params.castShadow;
    rotGroup.add( newMesh );
  }
  //
  const pLight = new THREE.PointLight( 0xff0000, 1.5, 3, 0.8 );
  rotGroup.add( pLight )
  pLight.position.set( 0,0.2,1.5 )
  var pLightMesh = new THREE.Mesh( new THREE.SphereGeometry( 0.05 ),  new THREE.MeshBasicMaterial({color:0xff0000,}) );
  pLight.add( pLightMesh )
}
function myAnimScene() {
  camera.position.set( 0,0.5, params.camPosZ )
  directionalLight.color = new THREE.Color( params.dirLightCol );
  camPLight.color = new THREE.Color( params.camLightCol );
}


var lastT = performance.now()  //ms since Page Load
animate()
function animate(){
  if( typeof rotGroup !== 'undefined' ) rotGroup.rotation.y += 0.1*params.speedFactor;
  myAnimScene()
  //
  // if(performance.now() - lastT > 30){}
  renderer.render( scene, camera );
  // 
  stats.update()  
  requestAnimationFrame( animate )  
}
	
</script>

</html>
