<!DOCTYPE html>
<html>
<body>
<head>
	<title>THREEJS DEMO2</title>
</head>



  
  
<script type="module">
import * as THREE from 'https://cdn.rawgit.com/mrdoob/three.js/r157/build/three.module.js';

var renderer = new THREE.WebGLRenderer( { antialias:false } );
document.body.appendChild( renderer.domElement );  
renderer.setSize( 800,800 );  //renderer.setPixelRatio( window.devicePixelRatio )

var camera = new THREE.PerspectiveCamera( 70, 800/800, 0.01, 900 );
var scene = new THREE.Scene();
{
  var waterBumpMap = new THREE.TextureLoader().load("https://cdn.rawgit.com/mrdoob/three.js/r156/examples/textures/water/Water_1_M_Normal.jpg")
  waterBumpMap.anisotropy=8;  waterBumpMap.repeat.set( 1,1 );  waterBumpMap.wrapS=waterBumpMap.wrapT=THREE.RepeatWrapping;
  
  renderer.shadowMap.enabled = true;
  scene.background = new THREE.Color( 0x0044ff );
  camera.position.set( 0,0.5,1.9 )

  var directionalLight = new THREE.DirectionalLight( 0xffffff, 1.5 );
  directionalLight.receiveShadow = directionalLight.castShadow = true;
  scene.add( directionalLight );  directionalLight.position.set( 1,1,1 ); 

  var ground = new THREE.Mesh(new THREE.PlaneGeometry(6,6, 100,100),  new THREE.MeshStandardMaterial({displacementMap:waterBumpMap,displacementScale:0.3}) );
  ground.position.y = -0.1;   ground.rotation.x = -Math.PI/2;
  ground.receiveShadow = true;  //ground.castShadow =
  scene.add( ground );
  
  {
    var cubeRenderTarget = new THREE.WebGLCubeRenderTarget( 512, { generateMipmaps:true, minFilter:THREE.LinearMipmapLinearFilter } );
    var cubeCamera = new THREE.CubeCamera( 0.1, 900, cubeRenderTarget );
    scene.add( cubeCamera );
    var chromeMaterial = new THREE.MeshStandardMaterial({envMap:cubeRenderTarget.texture, roughness:0.1,metalness:0.9, bumpMap:waterBumpMap,bumpScale:0.01, });
    var shinySphere = new THREE.Mesh( new THREE.SphereGeometry( 0.5, 30,30),  chromeMaterial );
    cubeCamera.add( shinySphere );
    var shinyQuad = new THREE.Mesh( new THREE.PlaneGeometry( 2.5,2.5 ),  chromeMaterial );
    cubeCamera.add( shinyQuad );  //shinyQuad.rotation.x = -Math.PI/2
    cubeCamera.position.set( 0,0.1,0 )
    //    
    setInterval( function(){
      cubeCamera.update( renderer, scene )
    },   35)
    
    var myPoints = new THREE.Points( 
      new THREE.SphereGeometry(1, 30,30), 
      new THREE.PointsMaterial({size:0.06,transparent:true,blending:THREE.AdditiveBlending,opacity:0.3,vertexColors:true})); //depthTest:true,depthWrite:true
    scene.add( myPoints );
    scene.myPoints = myPoints
    //
    setInterval( function(){
      var positionAttribute = myPoints.geometry.getAttribute( 'position' )
      var colors = [];
      for( var ii=0; ii<positionAttribute.count; ii++){  //positionAttribute.array.length
        const myCol = new THREE.Color().setHSL( Math.random(),1,0.5 )
        colors.push( myCol.r,myCol.g,myCol.b );
      }
      myPoints.geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
      // myPoints.geometry.getAttribute( 'color' ).needsUpdate = true
    },  500)
  }
}

	
animate();
function animate() {
  scene.myPoints.rotation.y += 0.005
  //
  renderer.render( scene, camera );
  requestAnimationFrame( animate );
}
</script>


  
</body>
</html>
